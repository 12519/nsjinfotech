<!DOCTYPE html>
<html>

<head>
	<title>HTAM</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
	
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- datepicker -->
<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">	


	<script>
		function getTestingCenters() {
			var apiKey = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxNDRiMzcyZS0yOWQzLTRkZGUtOGY3My1lN2NlMmY3YWJmMWQifQ.0EXHZRPyE4PO9Whl9oAMcGVnTW-trAccBvyLflY2XCA";
			$.ajax(
				{
					type: "GET",
					url: "http://tamminademoapps.com:8228/suite/webapi/FetchPatientReport",
					headers: { "Appian-API-Key": apiKey },
					contentType: "application/json",
					success: function (result) {
						for (i = 0; i < result.length; i++) {
							var opt = document.createElement("option");
							document.getElementById("testCenters").innerHTML += '<option id="' + i + '">' + result[i]["testcenter"] + '</option>';
							
						}
						
					},
					error: function () {
						console.log("There was an Issue with appian in starting a Process model");
						alert("Error");
					}
				});
		}
		
		function getInfo() {
			var apiKey = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxNDRiMzcyZS0yOWQzLTRkZGUtOGY3My1lN2NlMmY3YWJmMWQifQ.0EXHZRPyE4PO9Whl9oAMcGVnTW-trAccBvyLflY2XCA";
			var pid=document.getElementById("pid").value;
			var data = {
					pid: pid
				}
			$.ajax(
				{
					type: "GET",
					url: "http://tamminademoapps.com:8228/suite/webapi/getPatientInfo?pid="+pid+'.json',
					headers: { "Appian-API-Key": apiKey, contentType: "application/json" },
					success: function (result) {
						for (i = 0; i < result.length; i++) {
							var opt = document.createElement("option");
							document.myForm.name.value=  result[i]["pname"];
							document.myForm.age.value=  result[i]["age"];
							document.myForm.gender.value=  result[i]["gender"];
							document.myForm.email.value=  result[i]["emailId"];
							document.myForm.contact.value=  result[i]["mobilenumber"];
							document.myForm.address.value=  result[i]["address"];
							console.log(result);
						}
					},
					error: function (error) {
                        console.log(error);
						console.log("There was an Issue with appian in starting a Process model");
						alert("Error");
					}
                });
                
		}
		
	</script>
	<style>
		.code {
			background-size: 100%;
			border-radius: 6px;
			color: #212121;
			margin: 40px 20px;
			display: block;
			padding: 24px 15px;
			font: 14px/25px "Courier";
			background: #FFFFFF;
			box-shadow: 1px 1px 5px 0px rgba(0, 0, 0, 0.16);
			/* background-color: #FDB93A; */
			background-color:#87c1ac;
			font-family:  poppins,Arial,sans-serif;
		}

		body {
			/* background-color: #EAE8D8; */
			background-color:#458e84;
			display: flex;
			align-items: center;
			justify-content: center;
			font-family:  poppins,Arial,sans-serif;
		}

		.required {
			color: red;
			font-family:  poppins,Arial,sans-serif;
		}
		.form-control{
		font-family:  poppins,Arial,sans-serif;
			display: block;
    width: 100%;
    height: 34px;
    padding: 6px 12px;
    font-size: 14px;
    line-height: 1.42857143;
    color: #555;
    background-color: transparent;
    background-image: none;
    border: none;
    border-bottom: 2px solid #1d3d59;
    border-radius: 18px;
    -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
    box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
    -webkit-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
    -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
    -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
    transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
    transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
    transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
		}
		.form-control::placeholder{
			color: #EAE8D8!important;
			font-family:  poppins,Arial,sans-serif;
		}
		.btn-primary{
			background-color: #1D3D59!important;
			border-color: #fba88d!important;
			font-family:  poppins,Arial,sans-serif;
		}
		
	</style>
</head>

<body onload="getTestingCenters();">
	<section>
		<div class="code">
			<header style="    padding: 15px;
			/* background-color: #F46E41; */
			background-color: #688d9e;
			color: #f1f1f1;
			position: sticky;
			z-index: 100;
			top: 2px;
			border-radius: 18px;">
				<h3 class="h1header" style="font-family: 'roboto';margin:0;">Covid Home Test Appointment Management</h3>
				<!-- <img src="C:\Users\sandy\Downloads\Covid Application\edited Pics\htam_img.jpg" alt="logo" /> -->
			</header>
			<ul class="errorMessages"></ul>
			<div class="form-group">
					<label for="pid">Booking ID</label>
					<input type="text" class="form-control" onkeypress="return onlyNumberKey(event)" maxlength="5" 
					placeholder="Enter your Booking ID" 
			id="pid" required>
				</div>
			<button type="submit" class="btn btn-primary" onclick="getInfo();">Update Booking</button>
			<form name="myForm">
				<div class="form-group">
					<label for="name">Name</label>
					<input type="text" class="form-control" id="name" placeholder="Enter Name" required>
					<span class="required" id="nameerror"></span>
				</div>
				<div class="form-group">
					<label for="age">Age</label>
					<input type="number" class="form-control" id="age" placeholder="Enter Age" required>
					<span class="required" id="ageerror"></span>
				</div>
				<div class="form-group">
					<label for="gender">Gender</label>
					<select class="form-control" id="gender" required>
						<option value="">Select Gender</option>
						<option value="Male">Male</option>
						<option value="Female">Female</option>
					</select>
					<span class="required" id="gendererror"></span>
				</div>
				<div class="form-group">
					<label for="email">Email Address</label>
					<input type="email" class="form-control" id="email" placeholder="name@example.com" required>
					<span class="required" id="emailerror"></span>
				</div>
				<div class="form-group">
					<label for="contact">Contact No</label>
					<!-- <input type="text" class="form-control" id="contact" placeholder="Enter Contact Number" required maxlength="10"> -->
					<input type="text" class="form-control" onkeypress="return onlyNumberKey(event)" maxlength="10" placeholder="Enter your Contact Number" 
			id="contact" required>
					<span class="required" id="mobileerror"></span>
				</div>
				<div class="form-group">
					<label for="test-type">Test Type</label>
					<select class="form-control" id="test-type" required>
						<option value="">Select Test type</option>
						<option value="RTPCR Test">RTPCR Test</option>
						<option value="Rapid Antigen Test">Rapid Antigen Test</option>
					</select>
					<span class="required" id="testtypeerror"></span>
				</div>
				<div class="form-group">
					<label for="testCenters">Test Center</label>
					<select class="form-control" id="testCenters" required>
					<option value="">Select Test Center</option>
					</select>
					<span class="required" id="testcentererror"></span>
				</div>
				<div class="form-group">
					<label for="testDate">Test Date and Time</label>
					<div style="display: flex;">
						<div style="width: 50%;">
							<input type="text" placeholder="Select Test Date & Time" class="form-control"
								name="Test-Date" id="TestDate" required>
							<span class="input-group-prepend" style="display: none;">
								<span class="input-group-text">
									<i class="fa fa-calendar" onclick="setDatepicker(this)">
									</i>
								</span>
							</span>
						</div>
						<div style="width: 50%;">
							<input type="time" id="time" name="appt" min="09:00" max="18:00" class="form-control"
								required>
							<span class="required" id="datetimeerror"></span>
						</div>
					</div>
					<span class="required" id="datetimeerror"></span>
				</div>

				<div class="form-group">
					<label for="address">Address</label>
					<textarea type="text" rows="5" class="form-control" id="address" placeholder="Enter Address"
						required></textarea>
				</div>
				<div class="checkbox">
					<label><input type="checkbox" value="">I Accept <a data-toggle="modal" data-target="#myModal">Terms
							and Conditions </a></label>
				</div>
				<button id="action-button" type="submit" class="btn btn-primary">Book Appointment</button>
				
				<div id="myModal" class="modal fade" role="dialog">
					<div class="modal-dialog">
						<!-- Modal content-->
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal">&times;</button>
								<h4 class="modal-title">Terms & Conditions</h4>
							</div>
							<div class="modal-body">
								<ul>
									<li>After successful Form submission You will be receiving an SMS with your booking
										Details</li>
									<li>Do not eat, drink or brush your teeth 30 minutes before the test</li>
									<li>Wear a mask,sanitize yourself and keep your windows up</li>
									<li>Clean all high touch surfaces </li>
									<li>A lab technician will arrive at your doorStep for sample collection</li>

								</ul>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
							</div>
						</div>
					</div>
				</div>

			</form>
  <footer style="text-align: center;margin-top: 28px;">
	<small class="text-muted">Copyright@2020 Powered and Maintained by ITV @TT</small>
</footer>
		</div>

	</section>
</body>
<script>
// document.forms[0].onsubmit = function (){
// 	PostToApian();
// }

$( "#myForm" ).submit(function( event ) {
 
 // Stop form from submitting normally
 event.preventDefault();

 let data = {};
 for(let i=0;i<document.forms[0].elements.length;i++){
	data[document.forms[0].elements[i].id] = document.forms[0].elements[i].value;
 }
 PostToApian(data);
});

function PostToApian(data) {
	// var pname = document.getElementById("name").value;
	// var age = document.getElementById("age").value;
	// var gender = document.getElementById("gender").value;
	// var email = document.getElementById("email").value;
	// var location = document.getElementById("address").value;
	// var village = document.getElementById("vilage").value;
	// var district = document.getElementById("district").value;
	// var state = document.getElementById("state").value;
	// var nationality = document.getElementById("Nationality").value;
	// var pincode = document.getElementById("pincode").value;
	// var mobilenumber = document.getElementById("ContactNumber").value;
	// var time = document.getElementById("time").value;
	// var testType = document.getElementById("TestType").value;
	// var testDate = document.getElementById("TestDate").value;
	// var testCenter = document.getElementById("testCenters").value;
	var apiKey = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxNDRiMzcyZS0yOWQzLTRkZGUtOGY3My1lN2NlMmY3YWJmMWQifQ.0EXHZRPyE4PO9Whl9oAMcGVnTW-trAccBvyLflY2XCA";
	$.ajax(
		{

			type: "POST",
			url: "http://tamminademoapps.com:8228/suite/webapi/createRequest",
			headers: { "Appian-API-Key": apiKey },
			contentType: "application/json",
			data: JSON.stringify(data),
			success: function (result) {
				console.log(result);
				alert(result);
			},
			error: function () {
				console.log("There was an Issue with appian in starting a Process model");
				alert("Error");
			}
		});



}

	$(document).ready(function () {
		$("#TestDate").datepicker();
	});

	function onlyNumberKey(evt) {

		// Only ASCII charactar in that range allowed 
		var ASCIICode = (evt.which) ? evt.which : evt.keyCode
		if (ASCIICode > 31 && (ASCIICode < 48 || ASCIICode > 57))
			return false;
		return true;
	}

	function alphaOnly(event) {
		var key = event.keyCode;
		return ((key >= 65 && key <= 90) || key == 8);
	}
</script>

</html>